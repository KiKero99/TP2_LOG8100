name: CI Pipeline

on:
  push:
    branches:
      - main

jobs:
  security_tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up OWASP ZAP
        run: |
          # Commandes pour installer et configurer ZAP
          wget https://github.com/zaproxy/zap-cli/archive/refs/heads/master.zip
          unzip master.zip
          cd zap-cli-master
          pip install -r requirements.txt
          # Lancer ZAP et scanner l'application
          zap.sh -daemon -port 9090 &
          # Ici, ajoutez les commandes pour scanner votre application
          cd dvna-master
          zap-cli quick-scan --self-contained <URL_DE_VOTRE_APPLICATION>

  code_analysis:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: SonarQube Scan
        uses: sonarsource/sonarcloud-github-action@v1
        with:
          args: |
            -Dsonar.projectKey=<VOTRE_PROJECT_KEY>
            -Dsonar.host.url=https://sonarcloud.io
            -Dsonar.login=${{ secrets.ACCESS_TOKEN }}